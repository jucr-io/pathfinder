service_name: "max-test-subscription-handler"
link_version: "1.0"
federation_version: "2.7"
health_endpoint:
  hostname: 0.0.0.0
  port: 8088
router_endpoint:
  hostname: 0.0.0.0
  port: 8005
  path: "/graphql"
  subscription:
    inject_peer: "router.router"
message_consumer:
  kafka:
    # brokers: "localhost:9092"
    security_protocol: "plaintext"
    sasl_mechanism: "plain"
    # sasl_username: "abc"
    # sasl_password: "abc"
    session_timeout_ms: 10000
    heartbeat_interval_ms: 500

kv_store:
  redis:
    enabled: true
    # host: "127.0.0.1"
    # port: 6379
    # tls_enabled: false
    # db: 0
    # username: "jucr"
    # password: "jucr"

listeners:
  - operation: "chargingSessionChanged"
    entity_name: "ChargingSession"
    description: "Notify when a charging session has changed, here with custom description." # optional -- default=(autogenerated)
    id_key: "id"
    ttl_ms: 60000 # max time a subscription can run until terminated by the manager
    topics:
      - name: "evses.charging_sessions.integration_events.charging_session_started"
        delay_ms: 500 # optional delay between receiving and notifying the router
        data_serde: "protobuf_sr" # allowed: protobuf, protobuf_sr, json -- default=protobuf_sr
        data_source: "key" # allowed: key, value -- default=key
        protobuf_mapping: # only for protobuf, protobuf_sr -- default=id/1
          - key: "id"
            tag: 1
        json_mapping: # only for json -- default=id
          - key: "id"
            property: "accountId" # optional -- default key=property
        # rate_limit
      - name: "evses.charging_sessions.integration_events.charging_session_updated"
      - name: "evses.charging_sessions.integration_events.charging_session_terminated"
      - name: "evses.charging_sessions.integration_events.charging_session_finished"
        terminates_subscriptions: true # default=false
  - operation: "evseTelemetryChanged"
    entity_name: "EVSETelemetry"
    id_key: "evseIdDemo"
    ttl_ms: 3000
    topics:
      - name: "evses.evses.integration_events.evse_telemetry_updated"
        data_source: "value"
        protobuf_mapping:
          - key: "evseIdDemo"
            tag: 2
